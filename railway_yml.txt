services:
  voice-service:
    source: .
    build:
      buildCommand: pip install -r requirements.txt
      startCommand: python voice-processing-service.py
    variables:
      DEEPGRAM_API_KEY: ${{secrets.DEEPGRAM_API_KEY}}
      ELEVENLABS_API_KEY: ${{secrets.ELEVENLABS_API_KEY}}
      ELEVENLABS_VOICE_ID: ${{secrets.ELEVENLABS_VOICE_ID}}
      N8N_WEBHOOK_URL: ${{secrets.N8N_WEBHOOK_URL}}
      PORT: ${{PORT}}
    healthcheck:
      command: ["python", "-c", "import requests; requests.get('http://localhost:8080')"]
      interval: 30s
      timeout: 10s
      retries: 3